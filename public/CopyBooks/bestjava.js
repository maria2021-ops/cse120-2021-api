var BestBook = {
  "project": "Books",
  "owner": "Maria",
  "anun": "",
  "vernagir": "",
  "grox": "",
  "guyn": "",
  "coverurish": "",
  "EjiQanak": "",
  "Gin": "",
  "Pox": "",
  "bnakan": "",
  "Anpetq": "",
  "Chapser": "",
  "Tpagrox": "",
  "Or": "",
  "IskakanOr": "",
  "Tesak": "",
  "Tariq": "",
  "language": "",
  "grelvalue": "",
}



function HandleFullNameChange() {
  BestBook.anun = document.getElementById("anun").value;
}

function HandleVernagirChange() {
  BestBook.vernagir = document.getElementById("vernagir").value;
}

function HandleGroxChange() {
  BestBook.grox = document.getElementById("grox").value;
}

function HandleGuynChange() {
  BestBook.guyn = document.getElementById("guyn").value;
}

function HandleVorakChange(e) {
  BestBook.language = e.target.value;
  if (BestBook.language != "other") {
    BestBook.coverurish = "";
    document.getElementById("coverurish").style.display = "none";
  }
  else {
    document.getElementById("coverurish").style.display = "block";
  }
}

function HandleLavVorakChange() {
  if (BestBook.language == "other") {
    BestBook.coverurish = document.getElementById("coverurish").value;
    document.getElementById("coverurish").style.display = "block";
  }
}

function HandleEjiQanakChange() {
  BestBook.EjiQanak = document.getElementById("EjiQanak").value;
}

function HandleGinChange() {
  BestBook.Gin = document.getElementById("Gin").value;
}

function HandlePoxChange() {
  BestBook.Pox = document.getElementById("Pox").value;
}


function Handlelanguagechange(e) {
  BestBook.language = e.target.value;
  if (BestBook.language != "other") {
    BestBook.grelvalue = "";
    document.getElementById("grel").style.display = "none";
  }
  else {
    document.getElementById("grel").style.display = "block";
  }
}

function Handlegrelchange() {
  if (BestBook.language == "other") {
    BestBook.grelvalue = document.getElementById("grel").value;
    document.getElementById("grel").style.display = "block";
  }
}

function HandleIskakanLanguageChange(e) {
  BestBook.language = e.target.value;
  if (BestBook.language != "other") {
    BestBook.language = "";
    document.getElementById("bnakan").style.display = "none";
  }
  else {
    document.getElementById("bnakan").style.display = "block";
  }
}

function HandleIskakanLezuChange() {
  if (BestBook.language == "other") {
    BestBook.language = document.getElementById("bnakan").value;
    document.getElementById("bnakan").style.display = "block";
  }
}

function HandleAnpetqChange() {
  BestBook.Anpetq = document.getElementById("Anpetq").value;
}

function HandleChapserChange() {
  BestBook.Chapser = document.getElementById("Chapser").value;
}

function HandleTpagroxChange() {
  BestBook.Tpagrox = document.getElementById("Tpagrox").value;
}

function HandleOrChange() {
  BestBook.Or = document.getElementById("Or").value;
}

function HandleIskakanOrChange() {
  BestBook.IskakanOr = document.getElementById("IskakanOr").value;
}

function HandleTesakChange() {
  BestBook.Tesak = document.getElementById("Tesak").value;
}

function HandleTariqChange() {
  BestBook.Tariq = document.getElementById("Tariq").value;
}

function ShowTheData(e) {
  e.preventDefault();
  console.log(BestBook);
  $.ajax({
    type: 'POST',
    url: "https://cse120-2021-api-maria.herokuapp.com/data",
    data: BestBook,
    cache: false,
    dataType: 'json',
    success: function (data) {
      console.log("success");
    },
    error: function (xhr) {
      console.error("Error in post", xhr);
    },
    complete: function () {
      console.log("Complete");
    }
  });
}

function loadExistingData() {
  var existingData = [];
  $.ajax({
    type: "GET",
    url: "https://cse120-2021-api-maria.herokuapp.com/data",
    dataType: "json",
    success: function (data) {
      console.log("success", data);
      existingData = data;
      displayData(existingData.data);
    },
    error: function (data) {
      console.log("Error")
    }
  });
}

function displayData(existingData) {
  document.getElementById("existingData").innerHTML = "<ul>";
  for (var i = 0; i < existingData.length; i++) {
    currentBook = existingData[i];
    document.getElementById("existingData").innerHTML += "<li><i>" + currentBook.fullname + "</li> : <b>" + currentBook.title + "</b></li>";
  }
  document.getElementById("existingData").innerHTML += "</ul>"
}

function displayData(data) {
  document.getElementById("dataContainer").innerHTML = "";
  data.forEach(elem => {

    var item = document.createElement("div");
    item.id = "div" + elem["_id"];
    item.className = "item";
    if (Object.keys(elem).length == 1) {
      var span = document.createElement("span");
      span.innerHTML = "<i>Empty Element with autogenerated ID: </i>" + elem["_id"];
      item.appendChild(span);
    }
    Object.keys(elem).forEach(key => {
      if (key != "_id") {
        var span = document.createElement("span");

        var b = document.createElement("b");
        b.innerHTML = key + ": ";
        span.appendChild(b);

        span.className = "item";
        if (elem[key]) {
          span.innerHTML += elem[key];
        } else {

          var span1 = document.createElement("span");
          span1.className = "undefined";
          span1.innerHTML = "N/A";
          span.appendChild(span1)
        }
        item.appendChild(span);

        var br = document.createElement("br");
        item.appendChild(br);
      }
    })
    var button = document.createElement("button");
    button.innerHTML = "Delete";
    button.id = elem["_id"];
    button.addEventListener("click", function (e) {
      deleteData(e.target.id);
    }, false);
    item.appendChild(button);
    document.getElementById("dataContainer").appendChild(item);
  })

}

var loadedData = [];

function loadEditItem() {
  localStorage = window.localStorage;
  editItem = JSON.parse(localStorage.getItem("editItem"));
  console.log(editItem);
  document.getElementById("_id").innerHTML = editItem["_id"];
  document.getElementById("anun").value = editItem["anun"];
  document.getElementById("vernagir").value = editItem["vernagir"];
  document.getElementById("grox").value = editItem["grox"];
  document.getElementById("EjiQanak").value = editItem["EjiQanak"];
}

function editData(id) {
  var tmp = id.split("edit_");
  var item_id = tmp[1];

  loadedData.forEach(item => {
    if (item._id == item_id) {
      console.log(item);
      localStorage = window.localStorage;
      localStorage.setItem('editItem', JSON.stringify(item));
      document.location = "form2.html";
    }
  })
}
